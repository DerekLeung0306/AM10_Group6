---
title: "Booking.com European landscape analysis"
author: "Project Group 6"
date: "29/11/2020"
output: html_document
---
###Loading Packages
```{r}
library(ggplot2)
library(janitor)
library(tidyverse)
library(caret)
library(lubridate)
library(factoextra)
library(vroom)
library(Hmisc)
library(mice)
library(readxl)
library(skimr)
library(data.table)
library(grid)
library(pBrackets)
library(showtext)
font_add_google("Montserrat", "Montserrat") #downloading fonts from Google
showtext_auto()
library(data.table)
library(googlesheets4)
library(opencage)

```


###Importing the Data Set
```{r setup, include=FALSE}
hotels_raw<-vroom("Hotel_Reviews 2.csv") %>% clean_names()

global_hotel_chain_size <- read_excel("Global Hotel Chains Size.xlsx") %>%clean_names()
                                      
booking_satisfaction <- vroom("Europe Hotel Booking Satisfaction Score.csv")%>%clean_names()

country_continent <- vroom("continents2.csv")%>%clean_names()

```
# Story Time

 We are a group of individuals working within the Data Analytics Team at Booking.com, and have been asked to gather insights on the mid- to high-end (luxury) hotel market in Europe. We are to present our results to our Team Lead.
 
  
# Cleaning Data Set global_hotel_chain_sizec
First, let's have a look at the overall global luxury & upscale hotel market. 
```{r}
# let's have a look on our data set
describe(global_hotel_chain_size) 

#Remove empty columns and rows
global_hotel_chain_size_clean<-remove_empty(global_hotel_chain_size, which = c("rows","cols"))


describe(global_hotel_chain_size_clean) 

```

# Cleaning Data Set hotels_raw
```{r}
Hmisc::describe(hotels_raw)
```

```{r}
glimpse(hotels_raw)
hotels_date_correct<-hotels_raw %>% mutate(review_date=as.Date(review_date,"%d/%m/%Y")) %>% mutate(country=word(hotel_address,-1,sep=fixed(" ")))
glimpse(hotels_date_correct)
```

```{r}
#Remove empty columns and rows
hotel1<-remove_empty(hotels_date_correct, which = c("rows","cols"))%>%
  filter(!is.na(lat))

#Check for duplicates (visualize bots)
duplicates<-hotel1%>%get_dupes(positive_review, negative_review, hotel_name, reviewer_nationality)
duplicates

#delete duplicates
hotel2<-hotel1%>%
  distinct(positive_review, negative_review, hotel_name, reviewer_nationality, .keep_all = TRUE)

md.pattern(hotel2,rotate.names = T)

```


# Europe vs. different continents - Luxury Chains, Upper Upscale Chains
Now we are good to go. First analysis:
```{r}
 # distribution of all the variables chain scale
data.frame(table(global_hotel_chain_size_clean$chain_scale))

# changing variables to factors
global_hotel_chain_size_clean$chain_scale <- global_hotel_chain_size_clean$chain_scale %>% factor(levels= c("Economy Chains", "Midscale Chains", "Upper Midscale Chains","Upscale Chains", "Upper Upscale Chains", "Luxury Chains" ))

 # checking if the data is correct
data.frame(table(global_hotel_chain_size_clean$chain_scale))


# pivoting the data & cleaning
chain_size_pivot<-global_hotel_chain_size_clean %>% 
  pivot_longer(cols = 5:11, names_to= "region", values_to= "x", values_drop_na = TRUE) %>% 
  mutate( region = case_when(
    region== "africa" ~ "Africa",
    region=="apac" ~ "APAC countries",
    region== "c_s_america" ~ "Central & South America",
    region== "europe" ~ "Europe",
    region== "middle_east" ~ "Middle East",
    region== "n_america_excl_us" ~ "North America exlc. US",
    region== "united_states" ~ "United States",
  )) %>% 
  select(-x)
            
# Luxury Chains across countries
chain_size_pivot_relevant<- chain_size_pivot %>% 
  filter(chain_scale== "Luxury Chains"|| chain_scale== "Upper Upscale Chains" || chain_scale== "Upscale Chains" ) %>% 
  group_by( region) %>% 
  summarise(count=n())

# Upper Upscale Chains across countires
chain_size_pivot %>% 
  filter(chain_scale== "Upper Upscale Chains") %>% 
  group_by( region) %>% 
  summarise(count=n())

#Upscale Chains across countires
chain_size_pivot %>% 
  filter(chain_scale== "Upscale Chains") %>% 
  group_by( region) %>% 
  summarise(count=n())

# charts showing how big Europe is in these sectors

my_colours <- c("grey70", "#8856A7")
is_europe<-  chain_size_pivot_relevant%>% 
mutate(
    is_europe = ifelse(region == "Europe", TRUE, FALSE))

# Chart of the data across all the regions
first_plot<- ggplot(is_europe, aes(x=reorder(region,-count), y=count, fill=is_europe)) +
    geom_bar(stat="identity", alpha=0.8)+
theme_minimal() +
  theme(panel.grid.major.y = element_line(color = "gray60", size = 0.1),
        panel.background = element_rect(fill = "white", colour = "white"),
        axis.line = element_line(size = 1, colour = "grey80"),
        axis.ticks = element_line(size = 3,colour = "grey80"),
        axis.ticks.length = unit(.20, "cm"),
        plot.title = element_text(color = "#810F7C",size=15,face="bold", family= "Montserrat"),
        plot.subtitle = element_text(color = "#810F7C", face="plain", ,size= 10,family= "Montserrat"),
        plot.caption = element_text(color = "grey40", face="italic", ,size= 7,family= "Montserrat",hjust=0),
        axis.title.y = element_text(size = 8, angle = 90, family="Montserrat", face = "bold"),
        axis.text.y=element_text(family="Montserrat", size=7),
        axis.title.x = element_text(size = 8, family="Montserrat", face = "bold"),
        axis.text.x=element_text(family="Montserrat", size=7),
        legend.text=element_text(family="Montserrat", size=7),
        legend.title=element_text(family="Montserrat", size=8, face="bold"),
        legend.position = "none")+
    labs(title = " Europe is the most aboundant region \nin Luxury & Upper Upscale Chains", subtitle= "Number of Luxury, Upper Upscale & Upscale Chains across the regions", x="Region", y=" Number of chians", caption="Source: https://www.kaggle.com/ployyyywa/global-hotel-chain-presence") +
  scale_y_continuous()+
  scale_fill_manual(values = my_colours)+ 
   geom_label(aes(label=count),family = "Montserrat", fontface="bold", color="grey20", )
   
first_plot



```


# European landscape in terms of chain types

```{r}


# data on how in Europe the chains are distributed
chain_types_europe<- chain_size_pivot %>% 
  filter(region=="Europe") %>% 
  group_by( chain_scale) %>% 
  summarise(count=n())


my_colours2 <- c("grey70", "#7BCC8F")
is_chain<-  chain_types_europe%>% 
mutate(
    is_chain = ifelse(chain_scale == "Luxury Chains",  TRUE,
                      ifelse(chain_scale== "Upper Upscale Chains", TRUE, FALSE)))

# Chart of the data across all the regions
 
 gg<-ggplot(is_chain, aes(x=reorder(chain_scale,chain_scale), y=count, fill=is_chain)) +
    geom_bar(stat="identity", alpha=0.8)+
theme_minimal() +
  theme(panel.grid.major.y = element_line(color = "gray60", size = 0.1),
        panel.background = element_rect(fill = "white", colour = "white"),
        axis.line = element_line(size = 1, colour = "grey80"),
        axis.ticks = element_line(size = 3,colour = "grey80"),
        axis.ticks.length = unit(.20, "cm"),
        plot.title = element_text(color = "#4FBAB0",size=15,face="bold", family= "Montserrat"),
        plot.subtitle = element_text(color = "#4FBAB0", face="plain", ,size= 10,family= "Montserrat"),
        plot.caption = element_text(color = "grey40", face="italic", ,size= 7,family= "Montserrat",hjust=0),
        axis.title.y = element_text(size = 8, angle = 90, family="Montserrat", face = "bold"),
        axis.text.y=element_text(family="Montserrat", size=7),
        axis.title.x = element_text(size = 8, family="Montserrat", face = "bold"),
        axis.text.x=element_text(family="Montserrat", size=7),
        legend.text=element_text(family="Montserrat", size=7),
        legend.title=element_text(family="Montserrat", size=8, face="bold"),
        legend.position = "none")+
    labs(title = "Europe seems to be abundant in the chains of our aim ", subtitle= "Number of all the types of chains in Europe", x="Hotel sector", y=" Number of chians", caption="Source: https://www.kaggle.com/ployyyywa/global-hotel-chain-presence") +
  scale_y_continuous()+
  scale_fill_manual(values = my_colours2)+ 
   geom_label(aes(label=count),family = "Montserrat", fontface="bold", color="grey20", )
 
 my_text <- "Upper Upscale + Luxury = 162"
my_grob = grid.text(my_text, x=0.82,  y=0.7,gp=gpar(fontfamily="Montserrat",fontsize=10, col="#43A2CA", fontface="bold"))

gg + annotation_custom(my_grob)
 


```




